# HSL 线性求解器集成和性能对比

## 成功集成 HSL 库

已成功将 HSL (Harwell Subroutine Library) 集成到 Uno 优化框架中，包括：
- **MA27**: 稀疏对称不定线性求解器
- **MA57**: MA27 的改进版本，性能更优

## 配置步骤

1. **下载 HSL 库**：从官方获取 libHSL_binaries.v2025.7.21
2. **移除 macOS 隔离属性**：
   ```bash
   xattr -cr "/Users/shaoyiyang/Downloads/libHSL_binaries.v2025.7.21 2/"
   ```
3. **配置 CMake**：
   ```bash
   cmake .. -DHSL="/path/to/libhsl.dylib" -DMETIS="/path/to/libmetis.dylib"
   ```
4. **编译**：
   ```bash
   export LIBRARY_PATH="/opt/homebrew/lib/gcc/current:$LIBRARY_PATH"
   make uno_ampl -j8
   ```

## 性能对比测试

### 测试 1: hs015.nl (小规模问题)

| 求解器 | 状态 | 迭代次数 | CPU时间 |
|--------|------|----------|---------|
| MA27   | ✅ 成功 | 21 | 0.099s |
| MA57   | ✅ 成功 | 21 | 0.243s |
| MUMPS  | ✅ 成功 | 21 | 0.003s |
| Eigen  | ❌ 失败 | 2  | 0.002s |

### 测试 2: aug2dc.nl (大规模病态问题)

| 求解器 | 状态 | 迭代次数 | CPU时间 |
|--------|------|----------|---------|
| MA27   | ✅ 成功 | 14 | 2.217s |
| MA57   | ✅ 成功 | 14 | 2.788s |
| MUMPS  | ✅ 成功 | 14 | 2.916s |
| Eigen  | ❌ 失败 | 2  | 35.678s |

## 关键发现

### 1. 鲁棒性对比
- **HSL (MA27/MA57)** 和 **MUMPS** 都能成功处理病态矩阵
- **Eigen** 即使添加了矩阵缩放，仍无法处理极端病态问题

### 2. 性能特点
- **小规模问题**：
  - MUMPS 最快（0.003s）
  - MA27 次之（0.099s）
  - MA57 较慢（0.243s）

- **大规模问题**：
  - MA27 最快（2.217s）
  - MA57 和 MUMPS 相近（2.8-2.9s）
  - 三者都在14次迭代后收敛

### 3. 求解器特性

#### MA27
- 经典的多波前方法
- 内存效率高
- 适合中等规模问题
- 在大规模问题上表现出色

#### MA57
- MA27 的改进版
- 使用更先进的数值技术
- 提供更详细的诊断信息
- 内存使用更多但通常更稳定

#### MUMPS
- 现代的并行求解器
- 支持多种排序策略
- 在小规模问题上有优势
- 可扩展到并行计算

#### Eigen
- 通用线性代数库
- 适合良态矩阵
- 对病态问题缺乏鲁棒性

## 结论

1. **HSL 库成功集成**：MA27 和 MA57 都能正常工作，提供了 MUMPS 之外的可靠选择

2. **性能表现优异**：在大规模病态问题（aug2dc.nl）上，MA27 甚至比 MUMPS 更快

3. **鲁棒性一致**：所有专业求解器（MA27、MA57、MUMPS）都能处理 Eigen 无法解决的病态问题

4. **选择建议**：
   - **默认选择**：MUMPS（综合性能好，小问题快）
   - **大规模问题**：MA27（速度最快）
   - **需要诊断信息**：MA57（提供详细信息）
   - **简单问题**：Eigen（轻量级，编译简单）

## 技术细节

### 为什么专业求解器更鲁棒？

1. **数值稳定化技术**：
   - 主元选择策略
   - 矩阵缩放和平衡
   - 迭代改进

2. **专门优化**：
   - 针对稀疏矩阵的存储格式
   - 高效的符号分析
   - 缓存优化

3. **错误处理**：
   - 自动检测和处理奇异性
   - 正则化策略
   - 回退机制

### macOS 特殊注意事项

由于 macOS 的安全策略，需要移除下载文件的隔离属性：
```bash
xattr -cr /path/to/libHSL_binaries/
```

这是使用第三方动态库的必要步骤。